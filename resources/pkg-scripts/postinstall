#!/bin/sh

echo "Unloading and uninstalling old extensions..."
# unload old extensions
sudo kextunload /Library/Extensions/sweetspot.DexComUSB.kext

# delete old extensions
sudo rm -rf /Library/Extensions/sweetspot.DexcomUSB.kext

# install new extensions
echo "Installing and loading new extensions..."
sudo cp -R ./extensions/DexComUSB.kext /Library/Extensions/DexComUSB.kext
sudo chown -R root:wheel /Library/Extensions/DexcomUSB.kext
sudo kextload /Library/Extensions/DexComUSB.kext/

sudo cp -R ./extensions/SiLabsUSBDriver.kext /Library/Extensions/SiLabsUSBDriver.kext
sudo chown -R root:wheel /Library/Extensions/SiLabsUSBDriver.kext
sudo kextload /Library/Extensions/SiLabsUSBDriver.kext/

sudo cp -R ./extensions/ProlificUsbSerial.kext /Library/Extensions/ProlificUsbSerial.kext
sudo chown -R root:wheel /Library/Extensions/ProlificUsbSerial.kext
sudo kextload /Library/Extensions/ProlificUsbSerial.kext/

file="/tmp/TidepoolUploader.cnt"

if [ -e ${file} ]; then
    count=$(cat ${file})
else
    count=0
fi

((count++))

echo ${count} > ${file}

echo Loaded ${count} times
